<% content_for :title, "Validation demande - Eligia" %>

<div data-controller="remove-footer">
  <div class="fullscreen order-parts">

    <div class="form-order-steps">
      <div class="steps">
        <%= link_to change_order_path do %>
          <div class='step previous-step'>
            <p>Étape 1 :</p>
            <p>Résiliations</p>
          </div>
        <% end %>
        <%= link_to edit_order_path do %>
          <div class='step previous-step'>
            <p>Étape 2 :</p>
            <p>Informations nécessaires</p>
          </div>
        <% end %>
        <div class='step current-step'>
          <p>Étape 3 :</p>
          <p>Validation</p>
        </div>
        <div class="logo">
          <%= image_tag('eligia-sans-fond-vecto.svg', alt:'Logo Eligia') %>
        </div>
      </div>
    </div>

    <div class="form-order-div">
      <div class="form-order-infos">
        <%= link_to edit_order_path(@order), class:"btn-third small btn-round margin-bottom-four" do %>
          <i class="fa-solid fa-arrow-left"></i> Précédent
        <% end %>
        <div class="logo">
          <%= image_tag('eligia-sans-fond-vecto.svg', alt:'Logo Eligia') %>
        </div>
        <h1>3. Récapitulatif / Confirmation</h1>
      </div>

      <div class="form-order-content">
        <div class="main-order-divs">

          <div class="order-subdiv">
            <div class="d-flex justify-content-space-between">
            <h3 class="margin-bottom-three">Contrats</h3>
              <div class="align-start">
                <%= link_to change_order_path(@order), class:"btn-third small margin-top-three" do %>
                  <span class="bold padding-right-two font-size-larger">+</span>
                  <span>Ajouter</span>
                <% end %>
              </div>
            </div>
            <div class="box">
              <ul class="order-div-list no-padding">
                <% @order.order_accounts.each do |order_account| %>
                  <li class="order-div-item d-flex">
                    <% if order_account.account.status == "non_validated" %>
                      <div class="order-div-list-style-type-non-validated">
                        <%= order_account.account.name.upcase.split.map { |word| word[0] }.join %>
                      </div>
                      <div><%= order_account.account.name %></div>
                      <div class="order-div-item-non-validated">A valider</div>
                    <% else %>
                      <div class="order-div-list-style-type">
                        <%= order_account.account.name.upcase.split.map { |word| word[0] }.join %>
                      </div>
                      <div><%= order_account.account.name %></div>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
          <div>
            <div class="d-flex justify-content-space-between">
              <h3 class="margin-bottom-three">Documents</h3>
              <div class="align-start">
                <%= link_to edit_order_path(@order), class:"btn-third small margin-top-three" do %>
                  <span class="bold padding-right-two font-size-larger">+</span>
                  <span>Ajouter</span>
                <% end %>
              </div>
            </div>
            <div class="box">
              <% @order.order_documents.each do |order_document| %>
                <div class="order-div-item document">
                  <div><%= order_document.document.name %> :</div>
                  <% if order_document.document.format == 'pdf' %>
                    <div class="document-created-<%= order_document.document_file.attached? %>">
                      <%= order_document.document_file.attached? ? "OK" : "Document manquant"%>
                    </div>
                  <% else %>
                    <div class="document-created-<%= order_document.document_input.present? %>">
                      <%= order_document.document_input.present? ? "OK" : "Information manquante"%>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <% if current_user %>
          <div class="order-btn" data-controller="loading-spinner" data-action="click->loading-spinner#load">
            <%= button_tag(type: 'button', class: "learn-more", data: {"loading-spinner-target":"btn"}) do %>
              <%= link_to paiement_order_path do %>
                <span class="circle" aria-hidden="true">
                  <span class="icon arrow"></span>
                </span>
                <span class="button-text">
                    Paiement
                </span>
              <% end %>
            <% end %>
            <div class="lds-dual-ring display-none" data-loading-spinner-target='spinner'></div>
          </div>
        <% else %>
          <div class="order-btn">
            <%= button_tag(type: 'button', class: "learn-more") do %>
              <%= link_to new_user_registration_path do %>
                <span class="circle" aria-hidden="true">
                  <span class="icon arrow"></span>
                </span>
                <span class="button-text">
                    Continuer
                </span>
              <% end %>
            <% end %>
            <div class = "help margin-right-three">
              * Inscription ou <br>
              connexion nécessaire
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class='form-order-right'>
      <div class="logo">
        <%= image_tag('eligia-sans-fond-vecto.svg', alt:'Logo Eligia') %>
      </div>
      <p>
        <strong>Les documents manquants</strong> n'empêchent de continuer la procédure. <br><br>
        Vous pourrez <strong>compléter les documents depuis votre espace personnel.</strong>

      </p>
      <div class="flower-pot" style="background-image: url(<%= image_path 'pot-fleur.svg' %>)">
      </div>
    </div>

  </div>
</div>

<% content_for :title, "Validation demande - Eligia" %>


<div data-controller="remove-navbar remove-footer">
  <div class="fullscreen order-parts">

    <div class="form-order-steps">
      <div class="steps"><%= render_breadcrumbs tag: :p, separator: "" %></div>
    </div>

    <div class="form-order-div">
      <div class="form-order-infos">
        <div class="form-order-infos-title">
          <div class="avatar-order">3</div>
          <h2>Récapitulatif / Confirmation</h2>
        </div>
      </div>

      <div class="main-order-divs">
        <div class="order-divs">
          <ul class="order-div-list no-padding">
            <% @order.order_accounts.each do |order_account| %>
              <li class="order-div-item d-flex">
                <% if order_account.account.status == "non_validated" %>
                  <div class="order-div-list-style-type-non-validated">
                    <%= order_account.account.name.upcase.split.map { |word| word[0] }.join %>
                  </div>
                  <div><%= order_account.account.name %></div>
                  <div class="order-div-item-non-validated">A valider</div>
                <% else %>
                  <div class="order-div-list-style-type">
                    <%= order_account.account.name.upcase.split.map { |word| word[0] }.join %>
                  </div>
                  <div><%= order_account.account.name %></div>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
        <div class="order-divs">
          <% @order.order_documents.each do |order_document| %>
            <div class="order-div-item document">
              <div><%= order_document.document.name %> :</div>
              <% if order_document.document.format == 'pdf' %>
                <div class="document-created-<%= order_document.document_file.attached? %>">
                  <%= order_document.document_file.attached? ? "OK" : "Document manquant"%>
                </div>
              <% else %>
                <div class="document-created-<%= order_document.document_input.present? %>">
                  <%= order_document.document_input.present? ? "OK" : "Information manquante"%>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
      <% if current_user %>
        <div class="order-btn" data-controller="loading-spinner" data-action="click->loading-spinner#load">
          <%= button_tag(type: 'button', class: "learn-more", data: {"loading-spinner-target":"btn"}) do %>
            <%= link_to paiement_order_path do %>
              <span class="circle" aria-hidden="true">
                <span class="icon arrow"></span>
              </span>
              <span class="button-text">
                  Paiement
              </span>
            <% end %>
          <% end %>
          <div class="lds-dual-ring display-none" data-loading-spinner-target='spinner'></div>
        </div>
      <% else %>
        <div class='margin-bottom-five margin-top-five'><span class='bold'>Attention :</span> Vous devez vous connecter pour terminer les démarches</div>
        <div class="order-btn">
          <%= button_tag(type: 'button', class: "learn-more") do %>
              <%= link_to new_user_registration_path do %>
                <span class="circle" aria-hidden="true">
                  <span class="icon arrow"></span>
                </span>
                <span class="button-text">
                    Connexion
                </span>
              <% end %>
            <% end %>
        </div>
      <% end %>
    </div>

    <aside class="form-order-right">
      <div class='form-order-aside' style="background-image: url(<%= image_path 'pot-fleur.svg' %>)">
        <div class="logo">
          <%= image_tag('eligia-sans-fond-vecto.svg', alt:'Logo Eligia') %>
        </div>
        <p>
          Vous pouvez revenir à l'étape 1 pour rajouter d'<strong>autres comptes</strong> (avant paiement).<br><br>
          Pour rajouter les <strong>documents manquants</strong>, vous pourrez le faire en revenant à l'étape 2 ou depuis votre espace personnel (après paiement).
        </p>
      </div>
    </aside>
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  // const paymentButton = document.getElementById('pay');
  // paymentButton.addEventListener('click', () => {
  //   const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
  //   stripe.redirectToCheckout({
  //     sessionId: '<%= @order.checkout_session_id %>'
  //   });
  // });
</script>

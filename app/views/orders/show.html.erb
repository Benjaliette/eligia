<% content_for :title, "Mes démarches - Eligia" %>
<%= render 'shared/navbar' %>

<turbo-frame id="content">
<div class="fullscreen-no-navbar">
<div class="banner user-banner">
    <div class="container padding-top-zero padding-bottom-zero">
      <h1><span class='unbold'><%= @current_user.first_name %></span> <%= @current_user.last_name %> > <span class="unbold font-size-smaller"> <%= @order.deceased_first_name %> <%= @order.deceased_last_name.upcase %></span></h1>
      <p class="margin-bottom-zero margin-top-one"><em><%= @order.state_to_french %></em></p>
      <%= link_to '← retour', user_path(@current_user), class: 'btn-second small margin-top-two position-absolute' %>
    </div>
  </div>

  <div class="container">
    <div class="user-dashboard-content">
      <div class="order-dashboard-section">
      <% order_documents_to_add = @order.non_uploaded_order_documents %>
        <% unless @order.non_uploaded_order_documents.empty? %>
          <h3 class="dashboard-title margin-top-four fit-content">Documents/informations restants à ajouter :</h3>
          <div class='order-documents-grid'>
            <% order_documents_to_add.each do |order_document| %>
              <%= simple_form_for [@order, order_document], url: update_documents_order_order_document_path(@order, order_document), html: { id: order_document }, data: { controller:"loading-spinner", action:'turbo:submit-end->loading-spinner#unload' } do |f| %>
                <%= f.error_notification %>
                <div class="insert-document">
                  <div class="document-name d-inline-block"><p class='margin-top-zero'><%= order_document.document.name %></p></div>
                  <% if order_document.document.format == 'file' %>
                    <div data-check-document-target='infoDiv'></div>
                    <div class="document-btn-and-name">
                      <%= f.input :document_file,
                                  label: false,
                                  as: :file,
                                  input_html:{
                                    accept: '.png, .jpg, .jpeg, .pdf'
                                  },
                                  label_html:{
                                    class:'label-document-input d-inline-block margin-bottom-two',
                                    :'data-check-document-target' => 'documentForm'
                                  }
                        %>
                      <div class="file-name" data-add-file-target="fileNameDiv"></div>
                      <div id=<%= dom_id order_document %> class='error'></div>
                    </div>
                  <% else %>
                    <%= f.input :document_input, label: false, input_html: { class:'doc-input margin-left-zero' } %>
                    <div id=<%= dom_id order_document %> class='error'></div>
                  <% end %>
                  <div class="lds-dual-ring display-none small" data-loading-spinner-target='spinner'></div>
                  <%= f.submit "Valider", class:'file optional btn-third small margin-top-two', data: {"loading-spinner-target":"btn", action:"click->loading-spinner#load"} %>
                </div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="order-dashboard-section">
        <h3 class="dashboard-title margin-top-four fit-content">État des contrats à résilier :</h3>
        <div class='order-account-cards'>
          <% @order.order_accounts.each do |order_account| %>
            <%= render "orders/order_account_card", order_account: order_account %>
          <% end %>
        </div>
      </div>
    </div>
  </div>


</turbo-frame>

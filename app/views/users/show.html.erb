<% content_for :title, "Mon espace - Eligia" %>

<% content_for :scroll_navbar, 'scroll-navbar' %>
<% content_for :home_navbar, 'home-navbar' %>
<% content_for :notification_navbar, 'active' %>
<%= render 'shared/navbar' %>

<turbo-frame id="content">
<div class="fullscreen-no-navbar">
  <div class="banner user-banner">
    <div class="container padding-top-zero padding-bottom-zero">
      <h1><span class='unbold'><%= @current_user.first_name %></span> <%= @current_user.last_name %></h1>
      <p class="margin-bottom-zero margin-top-one"><em>Bienvenue sur votre espace personnel</em></p>
    </div>
  </div>

  <div class="container">
    <div class="user-dashboard-grid padding-top-four">
      <div class="user-dashboard-left">
        <div>
          <h2 class="dashboard-title">Vos démarches</h2>

          <% unless current_user.orders.present? %>
            <p>Vous n'avez pas encore commencé de démarche</p>
            <%= link_to "Commencer une démarche", new_order_path, class:"btn btn-principal small", data:{turbo: false}  %>
          <% end %>

          <div class="user-dashboard-content">
            <% @orders.each do |order| %>
              <%= link_to order_path(order) do %>
                <%= render "orders/order_dashboard_card", order: order %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="personal-info">
          <h2 class="dashboard-title margin-bottom-zero margin-top-zero">Vos informations personnelles</h2>

            <div class="account-infos-title">
            </div>
            <div class="account-infos-description">
              <div class="margin-bottom-two"><i class="fa-solid fa-envelope margin-right-three light-green"></i> <%= @current_user.email %></div>
              <div class="margin-bottom-two"><i class="fa-solid fa-user margin-right-three light-green"></i> <%= "#{@current_user.first_name} #{@current_user.last_name}" %></div>
              <div class="margin-bottom-two"><i class="fa-solid fa-location-dot margin-right-three light-green"></i>
                <% if @current_user.address %>
                  <%= @current_user.address %>
                <% else %>
                  <span class="account-infos-description-address">Vous n'avez pas encore renseigné d'adresse</span>
                <% end %>
              </div>
              <%= link_to "Modifier vos informations", edit_user_registration_path(@current_user), class: 'btn-third small' %>
            </div>
        </div>
      </div>
      <% if current_user.notifications.present? %>
        <div>
          <div class="notification-card">
            <div class="notification-head">
              <h2 class="home-subtitle">Notifications</h2>
            </div>
            <div class="notification-body">
              <ul class="notification-list">
                <% @notifications.each do |notification| %>
                  <li class="notification-list-item">
                    <%= link_to notification.order_account ? order_order_account_path(notification.order, notification.order_account) : order_path(notification.order) do %>
                      <div class="notification-content"><%= notification.content %></div>
                    <% end %>
                    <% notification_time = (Date.today - notification.created_at.to_datetime).to_i %>
                    <div class="notification-date"><%= notification_time < 1 ? "Aujourd'hui" : "Il y a #{notification_time} jours" %></div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
</turbo-frame>

<%= render 'shared/footer' %>
